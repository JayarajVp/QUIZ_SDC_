<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #quizContainer {
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Quiz</h1>

    <div id="nameInput">
        <label for="studentName">Enter Your Name:</label>
        <input type="text" id="studentName" required>
        <button id="startQuiz">Start Quiz</button>
    </div>

    <div id="quizContainer" class="hidden">
        <div id="questionDisplay"></div>
        <div id="timer">Time Remaining: <span id="time">40</span> seconds</div>
        <div id="options"></div>
        <button id="submitAnswer" class="hidden">Submit Answer</button>
        <div id="result" class="hidden"></div>
    </div>

    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let totalTime = 0;
        let timerInterval;

        document.getElementById('startQuiz').addEventListener('click', () => {
            const studentName = document.getElementById('studentName').value;
            if (studentName) {
                fetch('set.txt') // Path to set.txt
                    .then(response => response.text())
                    .then(data => {
                        questions = JSON.parse(data);
                        shuffleQuestions(questions);
                        
                        // Determine how many questions to take
                        const numberOfQuestions = Math.min(20, questions.length); // Get the lesser of 20 or total available questions
                        questions = questions.slice(0, numberOfQuestions); // Take only the required number of questions
                        
                        document.getElementById('nameInput').classList.add('hidden');
                        document.getElementById('quizContainer').classList.remove('hidden');
                        startQuestion();
                    })
                    .catch(err => console.error('Error loading questions:', err));
            } else {
                alert("Please enter your name!");
            }
        });

        function shuffleQuestions(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startQuestion() {
            if (currentQuestionIndex < questions.length) {
                displayQuestion(questions[currentQuestionIndex]);
                startTimer(40);
            } else {
                endQuiz();
            }
        }

        function displayQuestion(question) {
            document.getElementById('questionDisplay').innerHTML = `<strong>${question.question}</strong>`;
            const options = document.getElementById('options');
            options.innerHTML = '';
            question.answers.forEach(answer => {
                options.innerHTML += `<input type="radio" name="answer" value="${answer}"> ${answer}<br>`;
            });
            document.getElementById('submitAnswer').classList.remove('hidden');
        }

        function startTimer(duration) {
            let timeRemaining = duration;
            document.getElementById('time').textContent = timeRemaining;

            timerInterval = setInterval(() => {
                timeRemaining--;
                document.getElementById('time').textContent = timeRemaining;

                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    submitAnswer(); // Automatically submit answer when time is up
                }
            }, 1000);
        }

        document.getElementById('submitAnswer').addEventListener('click', submitAnswer);

        function submitAnswer() {
            clearInterval(timerInterval);
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            if (selectedAnswer) {
                if (selectedAnswer.value === questions[currentQuestionIndex].correctAnswer) {
                    score++;
                }
            }
            currentQuestionIndex++;
            totalTime += 40000; // Add 40 seconds in milliseconds (for total time)
            startQuestion(); // Move to next question
        }

        function endQuiz() {
            document.getElementById('quizContainer').classList.add('hidden');
            const studentName = document.getElementById('studentName').value;
            const resultDisplay = document.getElementById('result');
            resultDisplay.innerHTML = `<h2>${studentName}, your score: ${score}/${questions.length}</h2>`;
            resultDisplay.innerHTML += `<p>Total time taken: ${totalTime / 1000} seconds</p>`;
            resultDisplay.classList.remove('hidden');

            saveResult(studentName, score, totalTime); // Save results to file
        }

        function saveResult(name, score, time) {
            const result = { name, score, time };
            const blob = new Blob([JSON.stringify(result, null, 2)], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'result.txt';
            link.click();
        }
    </script>
</body>
</html>
