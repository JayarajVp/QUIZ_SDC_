<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <script type="module">
        // Import the necessary Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCXUOurYSr1T7hgio8L2JF_-3Odg8vutUg",
            authDomain: "quiz-fb5d9.firebaseapp.com",
            projectId: "quiz-fb5d9",
            storageBucket: "quiz-fb5d9.appspot.com",
            messagingSenderId: "916039221761",
            appId: "1:916039221761:web:df2104737062375b3ff600",
            measurementId: "G-BPTGDJXS8K"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let timer;
        let startTime;

        async function fetchQuestions() {
            const querySnapshot = await getDocs(collection(db, "questions"));
            querySnapshot.forEach(doc => {
                questions.push(doc.data());
            });

            // Shuffle questions
            questions = questions.sort(() => Math.random() - 0.5);
            startQuiz();
        }

        function startQuiz() {
            if (questions.length > 0) {
                displayQuestion();
                startTime = new Date(); // Start the timer
                timer = setInterval(updateTimer, 100); // Update timer every 100ms
            } else {
                alert("No questions available!");
            }
        }

        function displayQuestion() {
            const questionContainer = document.getElementById('questionContainer');
            const question = questions[currentQuestionIndex];
            questionContainer.innerHTML = `
                <h2>${question.question}</h2>
                ${question.answers.map((answer, index) => `
                    <div>
                        <input type="radio" name="answer" id="answer${index}" value="${answer}" required>
                        <label for="answer${index}">${answer}</label>
                    </div>
                `).join('')}
                <button onclick="submitAnswer()">Submit Answer</button>
            `;
        }

        function submitAnswer() {
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            if (selectedAnswer) {
                if (selectedAnswer.value === questions[currentQuestionIndex].correctAnswer) {
                    score++;
                }
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    displayQuestion();
                } else {
                    clearInterval(timer);
                    showResults();
                }
            } else {
                alert("Please select an answer!");
            }
        }

        function updateTimer() {
            const currentTime = new Date();
            const elapsedTime = currentTime - startTime;
            const totalSeconds = Math.floor(elapsedTime / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            document.getElementById('totalTime').innerText = `Total time taken: ${minutes} minutes ${seconds} seconds`;
        }

        function showResults() {
            document.getElementById('quizContainer').style.display = 'none';
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = `
                <h2>Results</h2>
                <p>Score: ${score} out of ${questions.length}</p>
                <p>${document.getElementById('totalTime').innerText}</p>
            `;
        }

        window.onload = fetchQuestions; // Fetch questions when the page loads
    </script>
</head>
<body>
    <div id="quizContainer">
        <h1>Welcome to the Quiz!</h1>
        <div id="questionContainer"></div>
        <p id="totalTime"></p>
    </div>
    <div id="resultsContainer"></div>
</body>
</html>
